version: "3.9"
services:
  frontend:
    image: "octopussamples/workflowbuilderfrontend"
    ports:
      - "5000:5000"
    volumes:
      # This configuration file is used to customize the frontend web application.
      - ${PWD}/config.json:/workspace/build/config.json
      # This public key is the public half of the key pair referenced by repocreator.
      - ${PWD}/public_key.pem:/workspace/build/public_key.pem
  templategenerator:
    image: "octopussamples/workflowbuildertemplategenerator"
    ports:
      - "4000:4000"
    expose:
      - "4000"
  auditdb:
    image: mysql:5.7
    restart: always
    environment:
      MYSQL_DATABASE: 'audit'
      MYSQL_USER: 'audits'
      MYSQL_PASSWORD: 'Password01!'
      MYSQL_ROOT_PASSWORD: 'Password01!'
    ports:
      - '3306:3306'
    expose:
      - '3306'
  audit:
    image: "octopussamples/auditsservice"
    ports:
      - "10000:10000"
    depends_on:
      - "auditdb"
    environment:
      - DATABASE_HOSTNAME=auditdb
      - DATABASE_PORT=3306
      - DATABASE_USERNAME=audits
      - DATABASE_PASSWORD=Password01!
      - COGNITO_DISABLE_AUTH=true
      - MIGRATE_AT_START=true
    command: ["./wait-for-it.sh", "auditdb:3306", "--strict", "--", "./application", "-Dquarkus.http.host=0.0.0.0"]
  repocreator:
    image: "octopussamples/githubrepocreator"
    ports:
      - "11000:11000"
    expose:
      - "10000"
    environment:
      - COGNITO_DISABLE_AUTH=true
      - GITHUB_ENCRYPTION=9YhZbd1V3dWwgshtm5XXmGpN83JNTuv1
      - GITHUB_SALT=9jjX1i7VxlPptBdw5EqJuC2AK058qYxe
      - REPO_POPULATOR=http://repocreator:11000
      - TEMPLATE_GENERATOR=http://templategenerator:4000
      - AUDIT_SERVICE=http://audit:10000
      # Create this key with:
      # openssl req  -nodes -new -x509  -keyout server.key -out server.cert
      # Convert pem to der:
      # openssl rsa -inform pem -in server.key -outform der -out server.der
      # Base 64 encode the private key with this command. The CLIENT_PRIVATE_KEY env var is the output of this command:
      # cat server.der | base64 -w0
      # Extract the public key (for use with frontend) with:
      # openssl x509 -pubkey -noout -in cert.pem > public_key.pem
      - CLIENT_PRIVATE_KEY=MIIEpAIBAAKCAQEApmcxZvB/sN2LaB4fbNpbB6PSbt2Vtwkbc1JbqixfdHjEw2PAFi55U9VhmtyYzYbf67REMQF0pyju2KqsEGfTvvKzdZrsmCjmGjq/HkkATRzp3ZVKBPiOtR8DjSXPoQ+Vh/ZyTW7M53RtjK/h4MevVUZGPMUAtJcHCQliIcELn98K8jsY2EaARFaNi1n6HFb/hUC/qi6J97R3NfUqkGC2LNaPtU2zfHYP2XakGq948PcEyIaBY3QH0b28NCh8EWY3goLt1VyRhtlrndMZpyZvtR3Ww/c/mIuN5pGwaRGsPHJ3oHB66Jfg8PGfjy0lDAkNFOqC5UsQwNeVOshn1Xg5JQIDAQABAoIBACCYE/gq4YgeTSEuzU8AElaTwzNOGfZJRWQ4XJYfrO7efQQctNJjdgZyxHSWAyQ26AN+QuEqfNQFU4uDGsL342UCmx5NI0zGrhOzMB5ZhEKWiESL6nzAxws5MPPj1SCiMdL49fiu3Fn110N4bBEga/qTEkzy9alp78nYWa1s577/m4FKENxYQKXmxf3QArxROQvelZeaPAZ5qihEsAe5gb/EQb4+yh2poaJfntygdGCkfj7z1J0LtL4haAIU7OSIohKy83lSUasbVn5WDA4FWZNR7adD625Dl4uLqaNOBVtvcx/yBmy77o87jN9GAF7Pi5myI15skMIxkxoIeHGUKoECgYEA0l5urvWlCsxqF0FfnC5pSxDVM5zr0BraOHNS8F2f2UbRE1lOAY6qNrkA9dAHSnmHlHmcbEdEMzm4vnnqGdAeb9G4lDE2ZPn9Lk8pQcumw7Otbf9Jog9UllcINK2p9VgvjUnWWkWsFUs6B2BuabXBtUnvyChiJVBms+czn17EZoUCgYEAyn9i1fbzH3lUyFwqVlhDEiRg/QWBq+iqIa+IMlUu4BqRxSOSPoNy4R+jEJ9YiBsBTJ9cPbwyqp5RfLsK7twArGcfde8Yu6sDVZ+eXljoeh3OmPcPo1sCAQK4Tee5TipNg3e+Ro03eItUzEaJ7nkUbAJ22XAc9zConPjP5xL/miECgYEAjfSrO+UHOgI2lPrISdwHsV/qfqmldwinuPAZR5nmA/iFnUjmGqbqtYKh4z49rUPU+ZwWsfplSyvoPqCGGGUYJNygcV/EFN+cuWMxs/R41BarMU7ToUg3DDwujV2jEqwvamgo/UGGndflkJTB7RN5Y5xA8hBOKl/W7g9WBnUskwECgYBA7r4rrCdjxU1JfjxZOa4wKBgtqlFdZZsAeD/tG+GPHRX3KCPiBdaVl8Z7Mw15f2dYQZWbejio+2FX5MZpt4RDxEGTWJsOupS0JR3sVQge+GXiKP8Lu8gVuOCOoqqKBQicCo6qIuhRsCP96PSb0pmY1OV1bfzryt+WjjZke3QY4QKBgQC1xvnilitLRNCGoCHMmo4bGzhcLvtetzKC3Ys1kkQtRdy7+/iZu1UWEUpd+qrNvP0EJ/mrNQmmlj5oKYHKYT83dzerUjwr5EJwd3dUKVem4S4PO3qeyo/XYed2b+3eZqhfQ/rx+Gs0gowzxLvcTn6xTEdHG6nH8tOJT0phJ9w6TQ==
  repoproxy:
    image: "octopussamples/githubrepoproxy"
    ports:
      - "12000:12000"
    expose:
      - "12000"      
    environment:
      - COGNITO_DISABLE_AUTH=true
      # Any random 32 chars will do, but they have to be shared with githuboauth
      - GITHUB_ENCRYPTION=9YhZbd1V3dWwgshtm5XXmGpN83JNTuv1
      # Any random 32 chars will do, but they have to be shared with githuboauth
      - GITHUB_SALT=9jjX1i7VxlPptBdw5EqJuC2AK058qYxe
  octopusproxy:
    image: "octopussamples/octopusproxy"
    ports:
      - "13000:13000"
    expose:
      - "13000"
    environment:
      - COGNITO_DISABLE_AUTH=true
  githuboauth:
    image: "octopussamples/githuboauthbackend"
    ports:
      - "14000:14000"
    expose:
      - "14000"
    environment:
      - GITHUB_REDIRECT=http://localhost:5000
      - GITHUB_LOGIN_REDIRECT=http://localhost:14000/oauth/github/code
      # Create a GitHub Oauth app and set the following env vars to the client ID and secret 
      - GITHUB_OAUTH_APP_CLIENT_ID
      - GITHUB_OAUTH_APP_CLIENT_SECRET
      # Any random 32 chars will do, but they have to be shared with repoproxy
      - GITHUB_ENCRYPTION=9YhZbd1V3dWwgshtm5XXmGpN83JNTuv1
      # Any random 32 chars will do, but they have to be shared with repoproxy
      - GITHUB_SALT=9jjX1i7VxlPptBdw5EqJuC2AK058qYxe
      # This value is not used, but must still be defined
      - LAMBDA_HANDLER=thisvalueisunused
      

      

